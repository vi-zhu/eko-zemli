function changeText(t,s){t.title&&void 0!==t.title&&(t.title=s)}!function(t){t.vWishlist||(vWishlist=function(t){this.ID=t.ID,this.EXISTS=t.EXISTS,this.PARENT_TYPE=t.PARENT_TYPE,this.PARENT_ID=t.PARENT_ID,this.ELEMENT_ID=t.ELEMENT_ID,this.WISHLIST_ELEMENT_ID=t.WISHLIST_ELEMENT_ID,this.AJAX_URL=t.AJAX_URL,this.self=BX(this.ID),this.DELAY_LOAD=t.DELAY_LOAD,this.USE_BATCH=t.USE_BATCH},vWishlist.prototype.onClick=function(){this.EXISTS?this.removeElement():this.addElement()},vWishlist.prototype.addElement=function(){BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.AJAX_URL,data:"ACTION=ADD&PARAM1="+this.PARENT_TYPE+"&PARAM2="+this.PARENT_ID+"&PARAM3="+this.ELEMENT_ID,onsuccess:BX.delegate(this.addHandler,this)})},vWishlist.prototype.addHandler=function(t){var s;t.result?(this.WISHLIST_ELEMENT_ID=t.WID,this.EXISTS=!0,BX.addClass(this.self,"exists"),changeText(this.self,"Убрать из Избранного"),s=parseInt($("#qty").text())+1,$("#qty").text(s)):this.handleError(t)},vWishlist.prototype.removeElement=function(){BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.AJAX_URL,data:"ACTION=DELETE&WID="+this.WISHLIST_ELEMENT_ID,onsuccess:BX.delegate(this.removeHandler,this)})},vWishlist.prototype.removeHandler=function(t){var s;t.result?(this.WISHLIST_ELEMENT_ID=0,this.EXISTS=!1,BX.removeClass(this.self,"exists"),changeText(this.self,"Добавить в Избранное"),s=parseInt($("#qty").text())-1,$("#qty").text(s)):this.handleError(t)},vWishlist.prototype.bindEvents=function(){BX.bind(this.self,"click",BX.proxy(this.onClick,this)),this.DELAY_LOAD&&(this.USE_BATCH?t.bwll.addCallback(this.checkHandler,this):BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.AJAX_URL,data:"ACTION=CHECK&PARAM1="+this.PARENT_TYPE+"&PARAM2="+this.PARENT_ID+"&PARAM3="+this.ELEMENT_ID,onsuccess:BX.delegate(this.checkHandler,this)}))},vWishlist.prototype.checkHandler=function(t){t.result?(this.WISHLIST_ELEMENT_ID=t.WID,this.EXISTS=!0,BX.addClass(this.self,"exists"),changeText(this.self,"Убрать из Избранного")):(this.WISHLIST_ELEMENT_ID=0,this.EXISTS=!1,BX.removeClass("exists"),changeText(this.self,"Добавить в Избранное"))},vWishlist.prototype.handleError=function(t){t.result||console.log(t.err_code)})}(window),window,window.vWishListListener||(vWishListListener=function(t){this.registeredCallbacks={},this.timeout=!1,this.AJAX_URL=t.AJAX_URL},vWishListListener.prototype.addCallback=function(t,s){var e=this.guid();this.registeredCallbacks[e]={callback:t,params:s,id:e},this.timeout&&(clearTimeout(this.timeout),this.timeout=!1),this.setTimeoutAJAX()},vWishListListener.prototype.getParams=function(){var t,s={is_batch:1,queries:[]};for(t in this.registeredCallbacks){var e=this.registeredCallbacks[t];s.queries.push({qid:e.id,params:{ACTION:"CHECK",PARAM1:e.params.PARENT_TYPE,PARAM2:e.params.PARENT_ID,PARAM3:e.params.ELEMENT_ID}})}return s},vWishListListener.prototype.setTimeoutAJAX=function(){var s=this;this.timeout=setTimeout(function(){var t=s.getParams();s.executeAJAX(t)},200)},vWishListListener.prototype.executeAJAX=function(t){var i=this;BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.AJAX_URL,data:t,onsuccess:function(t){for(var s in t.result){var e=t.result[s];"function"==typeof i.registeredCallbacks[s].callback&&i.registeredCallbacks[s].callback.call(i.registeredCallbacks[s].params,e),delete i.registeredCallbacks[s]}0<Object.keys(i.registeredCallbacks).length&&i.setTimeoutAJAX()}})},vWishListListener.prototype.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}),Object.keys||(Object.keys=function(t){var s,e=[];for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s);return e});